<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데모 - 항공편 데이터 관리 시스템</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>✈️ 항공편 데이터 관리 시스템</h1>
            <p class="subtitle">데모 프리뷰</p>
            <div class="user-info">
                <div class="user-profile">
                    <img id="userProfilePic" src="" alt="프로필" class="profile-pic">
                    <div class="user-details">
                        <span id="userDisplay">사용자: 로딩 중...</span>
                        <span id="userEmail" class="user-email"></span>
                    </div>
                </div>
                <button id="logoutBtn" class="btn btn-outline">데모 종료</button>
            </div>
        </header>

        <!-- 데이터 업데이트 섹션 -->
        <section id="updateSection" class="card">
            <h2>🔄 온라인 데이터 업데이트</h2>
            <div class="update-info">
                <p><strong>creworld.flyasiana.com</strong>에서 최신 항공편 정보를 가져와 <strong>Turso 클라우드 데이터베이스</strong>에 저장합니다.</p>
                <p class="warning">⚠️ 매번 로그인 정보를 입력해야 합니다.</p>
            </div>
            
            <!-- 로그인 폼 -->
            <form id="updateForm" class="update-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">크루월드 사용자명:</label>
                        <input type="text" id="username" name="username" placeholder="demo_user" required>
                    </div>
                    <div class="form-group">
                        <label for="password">크루월드 비밀번호:</label>
                        <input type="password" id="password" name="password" placeholder="demo_password" required>
                    </div>
                </div>
                
                <!-- 월 선택 버튼들 -->
                <div class="month-selection-buttons">
                    <div class="month-buttons-row">
                        <button type="button" class="month-btn" data-month="current">이번달</button>
                        <button type="button" class="month-btn" data-month="next">다음달</button>
                        <button type="submit" class="btn btn-success" id="updateBtn" disabled>온라인 업데이트 시작</button>
                    </div>
                </div>
            </form>
            
            <div id="updateStatus" class="status-message"></div>
            <div id="progressBar" class="progress-bar" style="display: none;">
                <div class="progress-fill"></div>
            </div>
        </section>

        <!-- 데모 정보 섹션 -->
        <section class="card">
            <h2>ℹ️ 데모 정보</h2>
            <div class="demo-info-content">
                <p>이 페이지는 <strong>데모 프리뷰</strong>입니다. 실제 기능을 테스트하려면:</p>
                <ol>
                    <li>Google OAuth 설정을 완료하세요</li>
                    <li>Turso 데이터베이스를 설정하세요</li>
                    <li>환경변수를 올바르게 설정하세요</li>
                    <li>실제 서버를 실행하세요</li>
                </ol>
                <div class="demo-buttons">
                    <button onclick="window.location.href='/login-demo'" class="btn btn-secondary">다시 데모 로그인</button>
                    <button onclick="window.location.href='/'" class="btn btn-primary">실제 로그인으로 이동</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        class DemoFlightDataApp {
            constructor() {
                this.selectedMonth = null;
                this.init();
            }

            init() {
                this.loadDemoUser();
                this.setupEventListeners();
            }

            loadDemoUser() {
                const demoUser = JSON.parse(localStorage.getItem('demoUser') || '{}');
                
                if (!demoUser.id) {
                    window.location.href = '/login-demo';
                    return;
                }

                const userDisplay = document.getElementById('userDisplay');
                const userEmail = document.getElementById('userEmail');
                const userProfilePic = document.getElementById('userProfilePic');
                
                userDisplay.textContent = demoUser.display_name || demoUser.username;
                userEmail.textContent = demoUser.email;
                
                if (demoUser.profile_picture) {
                    userProfilePic.src = demoUser.profile_picture;
                    userProfilePic.style.display = 'block';
                }
            }

            setupEventListeners() {
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    localStorage.removeItem('demoUser');
                    localStorage.removeItem('isDemoMode');
                    window.location.href = '/login-demo';
                });

                document.getElementById('updateForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleUpdateSubmit();
                });

                // 월 선택 버튼 이벤트
                document.querySelectorAll('.month-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectMonth(e.target.closest('.month-btn').dataset.month);
                    });
                });
            }

            selectMonth(monthType) {
                // 모든 버튼에서 선택 상태 제거
                document.querySelectorAll('.month-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });

                // 선택된 버튼에 선택 상태 추가
                const selectedBtn = document.querySelector(`[data-month="${monthType}"]`);
                selectedBtn.classList.add('selected');

                this.selectedMonth = monthType;

                // 업데이트 버튼 활성화 및 텍스트 업데이트
                const updateBtn = document.getElementById('updateBtn');
                const monthText = monthType === 'current' ? '이번달' : '다음달';
                updateBtn.textContent = `${monthText} 업데이트 시작`;
                updateBtn.disabled = false;
            }

            handleUpdateSubmit() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (!username || !password) {
                    this.showStatus('사용자명과 비밀번호를 입력해주세요.', 'error', 'updateStatus');
                    return;
                }

                if (!this.selectedMonth) {
                    this.showStatus('업데이트할 월을 선택해주세요.', 'error', 'updateStatus');
                    return;
                }

                const monthText = this.selectedMonth === 'current' ? '이번달' : '다음달';
                this.showStatus(`데모 모드: ${monthText} 업데이트가 시작되었습니다. (실제 업데이트는 불가능합니다.)`, 'info', 'updateStatus');
            }

            showStatus(message, type, elementId = 'updateStatus') {
                const statusElement = document.getElementById(elementId);
                statusElement.textContent = message;
                statusElement.className = `status-message ${type}`;
                
                setTimeout(() => {
                    statusElement.textContent = '';
                    statusElement.className = 'status-message';
                }, 5000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new DemoFlightDataApp();
        });
    </script>
</body>
</html>
