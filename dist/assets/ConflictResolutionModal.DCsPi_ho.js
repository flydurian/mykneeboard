import{R as x,r as S,j as t}from"./index.8oJwqbgR.js";import"./react-vendor.CdglivQu.js";import"./firebase-vendor.CQY7ULBN.js";import"./utils-vendor.Dc4w0XSH.js";const E=({isOpen:g,onClose:o,conflicts:r,onResolve:j,existingFlights:N=[]})=>{const[l,m]=x.useState([]),[v,f]=x.useState(!1),c=S.useRef(null);x.useEffect(()=>{g&&r.length>0&&m(r.map(e=>({flightId:e.flightId,useLocal:!0})))},[g,r]);const k=e=>{f(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{f(!1)},1e3)},b=(e,a)=>{m(s=>s.map(d=>d.flightId===e?{...d,useLocal:a}:d))},w=async()=>{try{for(const e of l){const a=r.find(h=>h.flightId===e.flightId);if(!a)continue;const s=N.find(h=>h.id===a.flightId),d={...s||{},id:a.flightId,flightNumber:a.flightNumber,date:a.date,route:a.route,status:a.localData.status,lastModified:a.localData.lastModified},u={...s||{},id:a.flightId,flightNumber:a.flightNumber,date:a.date,route:a.route,status:a.serverData.status,lastModified:a.serverData.lastModified};let i=d?.status;(!i||typeof i.departed>"u"||typeof i.landed>"u")&&(i=s?.status||u?.status||{departed:!1,landed:!1});let n=u?.status;(!n||typeof n.departed>"u"||typeof n.landed>"u")&&(n=s?.status||d?.status||{departed:!1,landed:!1});const I=(e.useLocal?"local":"server")==="local"?i:n,L={...u,...d,status:I,lastModified:new Date().toISOString()},D={flightId:a.flightId,useLocal:e.useLocal};await j([D])}o()}catch{alert("충돌 해결 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{}},y=e=>{if(!e)return"알 수 없음";try{return new Date(e).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"})}catch{return"알 수 없음"}},p=e=>e.departed&&e.landed?"이륙 완료, 착륙 완료":e.departed?"이륙 완료":e.landed?"착륙 완료":"대기 중";return g?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4 pt-safe",onClick:o,children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-lg md:max-w-lg lg:max-w-lg xl:max-w-lg w-full max-h-[90vh] flex flex-col overflow-hidden",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"bg-red-500 text-white p-4 flex-shrink-0",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-bold",children:"데이터 충돌 해결"}),t.jsx("button",{onClick:o,className:"text-white text-2xl",children:"×"})]}),t.jsxs("p",{className:"text-sm mt-1",children:[r.length,"개의 항공편에서 데이터 충돌이 발생했습니다. 사용할 데이터를 선택해주세요."]})]}),t.jsx("div",{className:`p-6 overflow-y-auto flex-grow bg-white dark:bg-gray-800 ${v?"scrollbar-show":"scrollbar-hide"}`,onScroll:k,children:r.map((e,a)=>t.jsxs("div",{className:"mb-6 p-4 border dark:border-gray-700 rounded-lg",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:[e.flightNumber," - ",e.route]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["날짜: ",new Date(e.date).toLocaleDateString("ko-KR")]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:`p-3 rounded-lg border-2 ${l.find(s=>s.flightId===e.flightId)?.useLocal?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50"}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h4",{className:"font-semibold text-blue-700 dark:text-blue-400",children:"로컬 데이터"}),t.jsx("input",{type:"radio",name:`conflict-${e.flightId}`,checked:l.find(s=>s.flightId===e.flightId)?.useLocal,onChange:()=>b(e.flightId,!0),className:"text-blue-600 focus:ring-blue-500"})]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-800 dark:text-gray-300",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"상태:"})," ",p(e.localData.status)]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"최종 수정:"}),t.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:y(e.localData.lastModified)})]})]})]}),t.jsxs("div",{className:`p-3 rounded-lg border-2 ${l.find(s=>s.flightId===e.flightId)?.useLocal?"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50":"border-green-500 bg-green-50 dark:bg-green-900/20"}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h4",{className:"font-semibold text-green-700 dark:text-green-400",children:"서버 데이터"}),t.jsx("input",{type:"radio",name:`conflict-${e.flightId}`,checked:!l.find(s=>s.flightId===e.flightId)?.useLocal,onChange:()=>b(e.flightId,!1),className:"text-green-600 focus:ring-green-500"})]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-800 dark:text-gray-300",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"상태:"})," ",p(e.serverData.status)]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:"최종 수정:"}),t.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:y(e.serverData.lastModified)})]})]})]})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/50 p-3 rounded-lg",children:[t.jsx("h5",{className:"font-medium text-yellow-800 dark:text-yellow-300 mb-2",children:"주요 차이점:"}),t.jsxs("ul",{className:"text-sm text-yellow-700 dark:text-yellow-200 space-y-1",children:[e.localData.status.departed!==e.serverData.status.departed&&t.jsxs("li",{children:["• 이륙 상태: 로컬(",e.localData.status.departed?"완료":"대기",") vs 서버(",e.serverData.status.departed?"완료":"대기",")"]}),e.localData.status.landed!==e.serverData.status.landed&&t.jsxs("li",{children:["• 착륙 상태: 로컬(",e.localData.status.landed?"완료":"대기",") vs 서버(",e.serverData.status.landed?"완료":"대기",")"]})]})]})]},e.flightId))}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-4 flex justify-end gap-3 flex-shrink-0",children:[t.jsx("button",{onClick:o,className:"px-4 py-2 text-gray-600 dark:text-gray-300 border border-gray-300 dark:border-gray-500 rounded",children:"취소"}),t.jsxs("button",{onClick:w,className:"px-6 py-2 bg-red-500 text-white rounded",children:["업데이트 (",r.length,"개)"]})]})]})}):null};export{E as default};
//# sourceMappingURL=ConflictResolutionModal.DCsPi_ho.js.map
