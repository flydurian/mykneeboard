const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.8oJwqbgR.js","assets/react-vendor.CdglivQu.js","assets/firebase-vendor.CQY7ULBN.js","assets/utils-vendor.Dc4w0XSH.js"])))=>i.map(i=>d[i]);
import{r,j as e,X as V,b as Z,u as O,s as A,c as X,_}from"./index.8oJwqbgR.js";import"./react-vendor.CdglivQu.js";import"./firebase-vendor.CQY7ULBN.js";import"./utils-vendor.Dc4w0XSH.js";const H=({isOpen:d,onClose:u,currentUser:l,theme:x,setTheme:y,selectedAirline:v="OZ",setSelectedAirline:p,userInfo:h,onSettingsUpdate:b})=>{const[a,c]=r.useState("airline"),[o,i]=r.useState(!1),[m,s]=r.useState(""),[N,f]=r.useState(""),[g,k]=r.useState(l?.displayName||""),[j,P]=r.useState(l?.emplId||""),[E,T]=r.useState(""),[w,D]=r.useState(""),[I,L]=r.useState(""),[C,B]=r.useState(v),S=r.useRef(null);if(r.useEffect(()=>{d&&l?.uid&&(async()=>{try{const n=await Z(l.uid);n&&(n.empl&&P(n.empl),n.userName?k(n.userName):n.displayName&&k(n.displayName),n.company&&B(n.company))}catch{}})()},[d,l?.uid]),r.useEffect(()=>{if(g&&S.current){const t=S.current;t.value!==g&&(t.value=g,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})))}},[g]),!d)return null;const $=async()=>{if(!g.trim()){s("이름을 입력해주세요.");return}if(!j.trim()){s("EMPL ID를 입력해주세요.");return}i(!0),s(""),f("");try{const t=await O(g.trim());t.success?(l?.uid&&(await A(l.uid,{empl:j.trim(),userName:g.trim()}),b&&await b(l.uid,{empl:j.trim(),userName:g.trim()})),f("이름과 EMPL ID가 성공적으로 변경되었습니다."),setTimeout(()=>{u()},2e3)):s(t.error||"이름 변경에 실패했습니다.")}catch{s("정보 변경 중 오류가 발생했습니다.")}i(!1)},M=async()=>{if(!E||!w||!I){s("모든 필드를 입력해주세요.");return}if(w!==I){s("새 비밀번호가 일치하지 않습니다.");return}if(w.length<6){s("새 비밀번호는 6자 이상이어야 합니다.");return}i(!0),s(""),f("");const t=await X(E,w);t.success?(f("비밀번호가 성공적으로 변경되었습니다."),T(""),D(""),L(""),setTimeout(()=>{u()},2e3)):s(t.error||"비밀번호 변경에 실패했습니다."),i(!1)},R=async()=>{if(!l?.uid){s("로그인이 필요합니다.");return}i(!0),s("");try{await A(l.uid,{airline:C})?(b&&await b(l.uid,{airline:C}),p&&p(C),f("항공사가 성공적으로 변경되었습니다."),setTimeout(()=>{u()},2e3)):s("항공사 설정 저장에 실패했습니다.")}catch{s("항공사 설정 저장 중 오류가 발생했습니다.")}finally{i(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center items-center z-50 p-4 pt-safe",onClick:u,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md p-6 relative animate-fade-in-up",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-6",children:"사용자 설정"}),e.jsxs("div",{className:"flex mb-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>c("airline"),className:`flex-1 py-2 px-2 sm:px-4 font-medium text-sm sm:text-base ${a==="airline"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"회사"}),e.jsx("button",{onClick:()=>c("base"),className:`flex-1 py-2 px-2 sm:px-4 font-medium text-sm sm:text-base ${a==="base"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"BASE"}),e.jsx("button",{onClick:()=>c("name"),className:`flex-1 py-2 px-2 sm:px-4 font-medium text-sm sm:text-base ${a==="name"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"이름"}),e.jsxs("button",{onClick:()=>c("password"),className:`flex-1 py-2 px-2 sm:px-4 font-medium text-sm sm:text-base ${a==="password"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:"비밀번호"}),e.jsx("span",{className:"sm:hidden",children:"비밀번호"})]}),e.jsx("button",{onClick:()=>c("theme"),className:`flex-1 py-2 px-2 sm:px-4 font-medium text-sm sm:text-base ${a==="theme"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"화면 테마"})]}),m&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg text-sm",children:m}),N&&e.jsx("div",{className:"mb-4 p-2 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-lg text-sm",children:N}),a==="name"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"새 이름"}),e.jsx("input",{ref:S,type:"text",style:{textTransform:"uppercase"},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"스케줄에 나오는 이름으로 입력하세요",onBlur:t=>k(t.target.value.toUpperCase()),onCompositionStart:t=>{t.currentTarget.dataset.composing="true"},onCompositionEnd:t=>{t.currentTarget.dataset.composing="false",k(t.currentTarget.value.toUpperCase())},onInput:t=>{t.currentTarget.dataset.composing!=="true"&&k(t.currentTarget.value.toUpperCase())}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"EMPL ID"}),e.jsx("input",{type:"text",value:j,onChange:t=>P(t.target.value.toUpperCase()),style:{textTransform:"uppercase"},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"EMPL ID를 입력하세요"})]}),e.jsx("button",{onClick:$,disabled:o,className:"w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"변경 중...":"정보 변경"})]}),a==="password"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"현재 비밀번호"}),e.jsx("input",{type:"password",value:E,onChange:t=>T(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"현재 비밀번호를 입력하세요"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"새 비밀번호"}),e.jsx("input",{type:"password",value:w,onChange:t=>D(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"새 비밀번호를 입력하세요 (6자 이상)"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"새 비밀번호 확인"}),e.jsx("input",{type:"password",value:I,onChange:t=>L(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"새 비밀번호를 다시 입력하세요"})]}),e.jsx("button",{onClick:M,disabled:o,className:"w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"변경 중...":"비밀번호 변경"})]}),a==="theme"&&e.jsx("div",{children:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"테마 선택"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{y("light"),localStorage.setItem("theme","light")},className:`flex-1 py-2 px-4 rounded-lg ${x==="light"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-600 dark:text-gray-200"}`,children:"라이트"}),e.jsx("button",{onClick:()=>{y("dark"),localStorage.setItem("theme","dark")},className:`flex-1 py-2 px-4 rounded-lg ${x==="dark"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-600 dark:text-gray-200"}`,children:"다크"}),e.jsx("button",{onClick:()=>{y("system"),localStorage.setItem("theme","system")},className:`flex-1 py-2 px-4 rounded-lg ${x==="system"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-600 dark:text-gray-200"}`,children:"시스템"})]})]})}),a==="airline"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-24 bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"relative h-48",children:["OZ","KE","7C"].map((t,n)=>e.jsx("div",{onClick:()=>B(t),className:`h-16 flex items-center justify-center cursor-pointer transition-all duration-200 ${C===t?"bg-gradient-to-br from-blue-500 to-blue-600 text-white font-bold shadow-lg transform scale-105":"text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-gray-200"}`,children:e.jsx("span",{className:"text-lg font-bold tracking-wider",children:t})},t))})})}),e.jsx("button",{onClick:R,disabled:o,className:"w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?"적용 중...":"확인"})]}),a==="base"&&e.jsx(z,{currentUser:l,onSettingsUpdate:b})]})})},z=({currentUser:d,onSettingsUpdate:u})=>{const[l,x]=r.useState(""),[y,v]=r.useState(!1),[p,h]=r.useState("");r.useEffect(()=>{(async()=>{try{if(!d?.uid)return;const{getUserSettings:c}=await _(async()=>{const{getUserSettings:i}=await import("./index.8oJwqbgR.js").then(m=>m.n);return{getUserSettings:i}},__vite__mapDeps([0,1,2,3])),o=await c(d.uid);o?.base&&x(String(o.base).toUpperCase());try{const{indexedDBCache:i}=await _(async()=>{const{indexedDBCache:s}=await import("./index.8oJwqbgR.js").then(N=>N.m);return{indexedDBCache:s}},__vite__mapDeps([0,1,2,3])),m=await i.loadUserSettings(d.uid);!o?.base&&m?.base&&x(String(m.base).toUpperCase())}catch{}}catch{}})()},[d?.uid]);const b=async()=>{const a=l.trim().toUpperCase();if(a&&!/^[A-Z]{3}$/.test(a)){h("BASE는 IATA 코드(세 글자)로 입력해주세요.");return}v(!0),h("");try{if(d?.uid){await A(d.uid,{base:a});try{const{indexedDBCache:c}=await _(async()=>{const{indexedDBCache:o}=await import("./index.8oJwqbgR.js").then(i=>i.m);return{indexedDBCache:o}},__vite__mapDeps([0,1,2,3]));await c.saveUserSettings(d.uid,{base:a})}catch{}u&&await u(d.uid,{base:a}),h("저장되었습니다.")}}catch{h("저장에 실패했습니다.")}finally{v(!1)}};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"BASE (IATA 코드)"}),e.jsx("input",{type:"text",value:l,onChange:a=>x(a.target.value.toUpperCase().replace(/[^A-Z]/g,"").slice(0,3)),maxLength:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 uppercase",placeholder:"IATA code로 입력해주세요 (예: ICN)"}),p&&e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:p}),e.jsx("button",{onClick:b,disabled:y,className:"mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:y?"저장 중...":"저장"})]})};export{H as default};
//# sourceMappingURL=UserSettingsModal.DnqzWe95.js.map
