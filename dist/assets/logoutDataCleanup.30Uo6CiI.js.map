{"version":3,"mappings":";2JAsCO,MAAMA,EAA4B,IAAY,CACnD,GAAI,CAEF,MAAMC,EAAQ,aAAa,QAAQ,OAAO,EAG1C,aAAa,QAGTA,GACF,aAAa,QAAQ,QAASA,CAAK,CAGvC,MAAgB,CAEhB,CACF,EAKaC,EAAyB,SAA2B,CAC/D,GAAI,CACF,GAAI,cAAe,OAAQ,CACzB,MAAMC,EAAY,CAChB,cACA,iBACA,cACA,wBAGF,UAAWC,KAAUD,EACnB,GAAI,CACF,MAAM,IAAI,QAAc,CAACE,EAASC,IAAW,CAC3C,MAAMC,EAAY,UAAU,eAAeH,CAAM,EAEjDG,EAAU,UAAY,IAAM,CAC1BF,EAAA,CACF,EAEAE,EAAU,QAAU,IAAM,CAExBF,EAAA,CACF,EAEAE,EAAU,UAAY,IAAM,CAE1BF,EAAA,CACF,CACF,CAAC,CACH,MAAgB,CAEhB,CAEJ,CAEF,MAAgB,CAEhB,CACF,EAKaG,EAAqB,MAAOC,GAAmC,CAC1E,GAAI,CAEEA,GACF,MAAMC,EAAe,WAAWD,CAAM,EAIxC,GAAI,CACF,KAAM,CAAE,YAAAE,CAAA,EAAgB,MAAAC,EAAA,4BAAAD,GAAA,KAAM,QAAO,qBAAe,OAAAE,KAAA,sBAAAF,CAAA,+BACpDA,EAAY,YACd,MAAgB,CAEhB,CAEF,MAAgB,CAEhB,CACF,EAKaG,EAAoB,SAA2B,CAC1D,GAAI,CAEF,GAAI,WAAY,OAAQ,CACtB,MAAMC,EAAa,MAAM,OAAO,OAChC,MAAM,QAAQ,IACZA,EAAW,IAAIC,GAAa,OAAO,OAAOA,CAAS,CAAC,EAExD,CAGA,GAAI,kBAAmB,UAAW,CAChC,MAAMC,EAAgB,MAAM,UAAU,cAAc,mBACpD,MAAM,QAAQ,IACZA,EAAc,IAAIC,GAAgBA,EAAa,YAAY,EAE/D,CAEF,MAAgB,CAEhB,CACF,EAKaC,EAA0B,IAAY,CACjD,GAAI,CACF,eAAe,OACjB,MAAgB,CAEhB,CACF,EAKaC,EAAkB,IAAY,CACzC,GAAI,CAEF,SAAS,OAAO,MAAM,GAAG,EAAE,QAASC,GAAW,CAC7C,MAAMC,EAAQD,EAAO,QAAQ,GAAG,EAC1BE,EAAOD,EAAQ,GAAKD,EAAO,OAAO,EAAGC,CAAK,EAAE,OAASD,EAAO,OAGlE,SAAS,OAAS,GAAGE,CAAI,iDACzB,SAAS,OAAS,GAAGA,CAAI,yDAAyD,OAAO,SAAS,QAAQ,GAC1G,SAAS,OAAS,GAAGA,CAAI,0DAA0D,OAAO,SAAS,QAAQ,EAC7G,CAAC,CACH,MAAgB,CAEhB,CACF,EAKaC,EAAkB,IAAY,CACzC,GAAI,CACF,GAAI,iBAAkB,OAAQ,CAE5B,MAAMC,EAAM,OAAe,aAAa,GAAI,GAAI,GAAI,EAAE,EAClDA,GACFA,EAAG,YAAaC,GAAY,CAC1BA,EAAG,WAAW,0CAA0C,CAC1D,CAAC,CAEL,CACF,MAAgB,CAEhB,CACF,EAKaC,EAAwB,IAAY,CAC/C,GAAI,CACF,GAAI,qBAAsB,OAAQ,CAChC,MAAMC,EAAY,OAAe,iBAC7BA,IACFA,EAAS,SACTA,EAAS,YAEb,CACF,MAAgB,CAEhB,CACF,EAMaC,EAAmB,MAAOpB,GAAmC,CACxE,GAAI,CAEFT,EAAA,EAGAmB,EAAA,EAGAC,EAAA,EAGA,MAAMlB,EAAA,EAGN,MAAMM,EAAmBC,CAAM,EAG/B,MAAMK,EAAA,EAGNU,EAAA,EAGAG,EAAA,CAEF,MAAgB,CAEhB,CACF","names":["clearUserLocalStorageData","theme","clearUserIndexedDBData","databases","dbName","resolve","reject","deleteReq","clearUserCacheData","userId","indexedDBCache","simpleCache","__vitePreload","n","clearBrowserCache","cacheNames","cacheName","registrations","registration","clearSessionStorageData","clearCookieData","cookie","eqPos","name","clearWebSQLData","db","tx","clearApplicationCache","appCache","clearAllUserData"],"ignoreList":[],"sources":["../../utils/logoutDataCleanup.ts"],"sourcesContent":["/**\n * 로그아웃 시 모든 사용자 데이터를 삭제하는 유틸리티 함수들\n */\n\nimport { indexedDBCache } from './indexedDBCache';\n\n// localStorage에서 사용자 관련 데이터 키들\nconst USER_DATA_KEYS = [\n  // 인증 관련\n  'offline_auth_data',\n  'offline_user_data',\n  \n  // 비행 데이터 캐시\n  'flight_dashboard_cache_metadata',\n  'internationalFlights',\n  'domesticFlights',\n  'lastGoogleSheetsSync',\n  \n  // 날씨 데이터 캐시 (동적으로 생성되는 키들)\n  // weather_*, forecast_*, metar_*, taf_*, exchange_*\n  \n  // 계산기 상태\n  'pilotRestCalculatorState',\n  \n  // 경고 해제 상태\n  'passport_visa_warning_dismissed',\n  \n  // 동기화 큐\n  'sync_queue',\n  \n  // 캐시 관련\n  'auth_user'\n];\n\n/**\n * localStorage에서 사용자 관련 데이터를 모두 삭제합니다.\n * 테마 설정은 유지됩니다.\n */\nexport const clearUserLocalStorageData = (): void => {\n  try {\n    // 테마 설정 백업\n    const theme = localStorage.getItem('theme');\n    \n    // 모든 localStorage 데이터 삭제\n    localStorage.clear();\n    \n    // 테마 설정 복원\n    if (theme) {\n      localStorage.setItem('theme', theme);\n    }\n    \n  } catch (error) {\n    console.error('❌ localStorage 데이터 삭제 실패:', error);\n  }\n};\n\n/**\n * IndexedDB의 모든 사용자 관련 데이터베이스를 삭제합니다.\n */\nexport const clearUserIndexedDBData = async (): Promise<void> => {\n  try {\n    if ('indexedDB' in window) {\n      const databases = [\n        'flightCache',\n        'separatedCache', \n        'simpleCache',\n        'FlightDashboardCache' // indexedDBCache에서 사용하는 데이터베이스명\n      ];\n      \n      for (const dbName of databases) {\n        try {\n          await new Promise<void>((resolve, reject) => {\n            const deleteReq = indexedDB.deleteDatabase(dbName);\n            \n            deleteReq.onsuccess = () => {\n              resolve();\n            };\n            \n            deleteReq.onerror = () => {\n              console.warn(`⚠️ IndexedDB 데이터베이스 삭제 실패: ${dbName}`, deleteReq.error);\n              resolve(); // 하나 실패해도 계속 진행\n            };\n            \n            deleteReq.onblocked = () => {\n              console.warn(`⚠️ IndexedDB 데이터베이스 삭제 차단됨: ${dbName}`);\n              resolve(); // 차단되어도 계속 진행\n            };\n          });\n        } catch (error) {\n          console.warn(`⚠️ IndexedDB 데이터베이스 ${dbName} 삭제 중 오류:`, error);\n        }\n      }\n    }\n    \n  } catch (error) {\n    console.error('❌ IndexedDB 데이터 삭제 실패:', error);\n  }\n};\n\n/**\n * 캐시 매니저를 통해 모든 캐시 데이터를 삭제합니다.\n */\nexport const clearUserCacheData = async (userId?: string): Promise<void> => {\n  try {\n    // indexedDBCache의 clearCache 메서드 사용\n    if (userId) {\n      await indexedDBCache.clearCache(userId);\n    }\n    \n    // simpleCache의 clearCache 메서드 사용 (userId가 없어도 동작)\n    try {\n      const { simpleCache } = await import('./simpleCache');\n      simpleCache.clearCache();\n    } catch (error) {\n      console.warn('⚠️ SimpleCache 삭제 실패:', error);\n    }\n    \n  } catch (error) {\n    console.error('❌ 캐시 데이터 삭제 실패:', error);\n  }\n};\n\n/**\n * Service Worker 캐시와 브라우저 캐시를 삭제합니다.\n */\nexport const clearBrowserCache = async (): Promise<void> => {\n  try {\n    // Service Worker 캐시 삭제\n    if ('caches' in window) {\n      const cacheNames = await caches.keys();\n      await Promise.all(\n        cacheNames.map(cacheName => caches.delete(cacheName))\n      );\n    }\n    \n    // Service Worker 등록 해제\n    if ('serviceWorker' in navigator) {\n      const registrations = await navigator.serviceWorker.getRegistrations();\n      await Promise.all(\n        registrations.map(registration => registration.unregister())\n      );\n    }\n    \n  } catch (error) {\n    console.error('❌ 브라우저 캐시 삭제 실패:', error);\n  }\n};\n\n/**\n * sessionStorage 데이터를 삭제합니다.\n */\nexport const clearSessionStorageData = (): void => {\n  try {\n    sessionStorage.clear();\n  } catch (error) {\n    console.error('❌ sessionStorage 데이터 삭제 실패:', error);\n  }\n};\n\n/**\n * Cookie 데이터를 삭제합니다.\n */\nexport const clearCookieData = (): void => {\n  try {\n    // 현재 도메인의 모든 쿠키 삭제\n    document.cookie.split(\";\").forEach((cookie) => {\n      const eqPos = cookie.indexOf(\"=\");\n      const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();\n      \n      // 쿠키 삭제 (과거 날짜로 설정)\n      document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;\n      document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname}`;\n      document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.${window.location.hostname}`;\n    });\n  } catch (error) {\n    console.error('❌ Cookie 데이터 삭제 실패:', error);\n  }\n};\n\n/**\n * WebSQL 데이터베이스를 삭제합니다 (구형 브라우저 지원).\n */\nexport const clearWebSQLData = (): void => {\n  try {\n    if ('openDatabase' in window) {\n      // WebSQL은 구형 브라우저에서만 지원되므로 try-catch로 안전하게 처리\n      const db = (window as any).openDatabase('', '', '', '');\n      if (db) {\n        db.transaction((tx: any) => {\n          tx.executeSql('DROP DATABASE IF EXISTS flight_dashboard');\n        });\n      }\n    }\n  } catch (error) {\n    // WebSQL이 지원되지 않는 경우 무시\n  }\n};\n\n/**\n * Application Cache를 삭제합니다 (구형 브라우저 지원).\n */\nexport const clearApplicationCache = (): void => {\n  try {\n    if ('applicationCache' in window) {\n      const appCache = (window as any).applicationCache;\n      if (appCache) {\n        appCache.update();\n        appCache.swapCache();\n      }\n    }\n  } catch (error) {\n    // Application Cache가 지원되지 않는 경우 무시\n  }\n};\n\n/**\n * 모든 사용자 데이터를 삭제합니다.\n * 로그아웃 시 호출되는 메인 함수입니다.\n */\nexport const clearAllUserData = async (userId?: string): Promise<void> => {\n  try {\n    // 1. localStorage 데이터 삭제 (테마 제외)\n    clearUserLocalStorageData();\n    \n    // 2. sessionStorage 데이터 삭제\n    clearSessionStorageData();\n    \n    // 3. Cookie 데이터 삭제\n    clearCookieData();\n    \n    // 4. IndexedDB 데이터베이스 삭제\n    await clearUserIndexedDBData();\n    \n    // 5. 캐시 데이터 삭제\n    await clearUserCacheData(userId);\n    \n    // 6. 브라우저 캐시 및 Service Worker 삭제\n    await clearBrowserCache();\n    \n    // 7. WebSQL 데이터 삭제 (구형 브라우저 지원)\n    clearWebSQLData();\n    \n    // 8. Application Cache 삭제 (구형 브라우저 지원)\n    clearApplicationCache();\n    \n  } catch (error) {\n    console.error('❌ 사용자 데이터 삭제 중 오류:', error);\n  }\n};\n\n/**\n * 특정 사용자의 데이터만 삭제하는 함수 (다중 사용자 지원)\n */\nexport const clearSpecificUserData = async (userId: string): Promise<void> => {\n  try {\n    // IndexedDB에서 특정 사용자 데이터만 삭제\n    await indexedDBCache.clearCache(userId);\n    \n    // localStorage는 사용자별로 구분되지 않으므로 전체 삭제\n    clearUserLocalStorageData();\n  } catch (error) {\n    console.error(`❌ 사용자 ${userId}의 데이터 삭제 중 오류:`, error);\n  }\n};\n"],"file":"assets/logoutDataCleanup.30Uo6CiI.js"}