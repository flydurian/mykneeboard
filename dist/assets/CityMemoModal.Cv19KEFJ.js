import{r as d,j as o,X as ce}from"./index.8oJwqbgR.js";import"./react-vendor.CdglivQu.js";import"./firebase-vendor.CQY7ULBN.js";import"./utils-vendor.Dc4w0XSH.js";const me=({isOpen:A,onClose:D,cityCode:h,initialMemo:b,onSave:H})=>{const[g,m]=d.useState(b),[P,R]=d.useState(!1),u=d.useRef(b),[_,y]=d.useState(b?.length||0),[C,j]=d.useState(!1),[p,S]=d.useState(!1),[v,L]=d.useState(!1),[w,M]=d.useState(!1),[k,F]=d.useState(!1),O=d.useRef(null),i=d.useRef(null),z=1e4;d.useEffect(()=>(A?(m(b),S(!1),document.body.style.overflow="hidden",setTimeout(()=>{N()},0)):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[A,b]),d.useEffect(()=>{if(p){const e=i.current;if(!e)return;e.innerHTML!==g&&(e.innerHTML=g||""),setTimeout(()=>{const t=i.current;if(!t)return;t.focus();const r=document.createRange(),s=window.getSelection();r.selectNodeContents(t),r.collapse(!1),s?.removeAllRanges(),s?.addRange(r)},100)}},[p,g]);const N=()=>{if(i.current){const e=i.current,t=300,r=e.scrollHeight,s=Math.max(t,r);e.style.height=s+"px",e.style.overflowY="auto"}},I=e=>{if(P)return;const t=e.target;u.current=t.innerHTML,y(u.current.length),setTimeout(()=>{N()},0)},X=()=>{R(!0)},$=()=>{R(!1),i.current&&(u.current=i.current.innerHTML,y(u.current.length)),setTimeout(()=>{N()},0)},W=e=>{const t=e.replace(/\r/g,"").split(`
`),r=[];for(let s=0;s<t.length;s++){const a=t[s],l=s+1<t.length?t[s+1]:"",n=l.trim().length===0,c=/^\s*(?:â€¢|-|\d+\.|\d+\))/u.test(l);s<t.length-1?a.trim().length===0?r.push(""):n||c?(r.push(a),r.push(""),n&&s++):r.push(a+" "):r.push(a)}return r.join(`
`).replace(/ +/g," ").replace(/\n{2,}/g,`
`)},G=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),U=e=>{const t=document.createElement("div");t.innerHTML=e;const r=new Set(["b","strong","i","em","u","span","br","ul","ol","li","p","div"]),s=new Set(["color","background-color","font-weight","font-style","text-decoration"]),a=n=>{if(!n.hasAttribute("style"))return;const c=n.getAttribute("style")||"",x=[];c.split(";").forEach(f=>{const[E,T]=f.split(":");if(!E||!T)return;const B=E.trim().toLowerCase(),ie=T.trim();s.has(B)&&x.push(`${B}: ${ie}`)}),x.length>0?n.setAttribute("style",x.join("; ")):n.removeAttribute("style")},l=(n,c)=>{Array.from(n.childNodes).forEach(x=>{if(x.nodeType===Node.ELEMENT_NODE){const f=x,E=f.tagName.toLowerCase();if(!r.has(E)){for(;f.firstChild;)n.insertBefore(f.firstChild,f);n.removeChild(f);return}E==="span"?a(f):f.removeAttribute("style"),Array.from(f.attributes).forEach(T=>{T.name.toLowerCase()!=="style"&&f.removeAttribute(T.name)}),l(f)}else x.nodeType===Node.TEXT_NODE||n.removeChild(x)})};return l(t),t.querySelectorAll("li").forEach(n=>{let c=n.innerHTML;c=c.replace(/<br\s*\/?>(\s|&nbsp;)*?/gi," "),c=c.replace(/&nbsp;/gi," "),c=c.replace(/\s{2,}/g," "),n.innerHTML=c.trim()}),t.innerHTML},Y=e=>{if(!i.current)return;e.preventDefault();const t=e.clipboardData.getData("text/html");if(t){const r=U(t);document.execCommand("insertHTML",!1,r)}else{const r=e.clipboardData.getData("text/plain"),s=W(r),a=G(s).replace(/\n/g,"<br>");document.execCommand("insertHTML",!1,a)}u.current=i.current.innerHTML,y(u.current.length),setTimeout(()=>N(),0)};d.useEffect(()=>{!p&&i.current&&g!==i.current.innerHTML&&(i.current.innerHTML=g||`<span class="text-gray-500 dark:text-gray-400">${h} ë„ì‹œì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”...</span>`,setTimeout(()=>{N()},0))},[g,p,h]);const K=e=>{if(e.key==="Enter"){document.execCommand("insertLineBreak"),e.preventDefault();return}},q=(e=!1)=>{if(i.current){const t=window.getSelection();if(t&&t.rangeCount>0){const r=t.getRangeAt(0),l="    "+(e?"1. ":"â€¢ "),n=document.createTextNode(l);r.deleteContents(),r.insertNode(n),r.setStartAfter(n),r.setEndAfter(n),t.removeAllRanges(),t.addRange(r),m(i.current.innerHTML)}}},V=e=>{if(!i.current)return;const t=window.getSelection();if(!(t&&t.rangeCount>0))return;const r=t.getRangeAt(0);if(!r)return;const s=r.toString();if(!s)return;const a=document.createElement("span");a.style.fontSize=`${e}px`,a.textContent=s,r.deleteContents(),r.insertNode(a),r.setStartAfter(a),r.setEndAfter(a),t.removeAllRanges(),t.addRange(r),u.current=i.current.innerHTML,y(u.current.length)},J=e=>{if(i.current){const t=window.getSelection();if(t&&t.rangeCount>0){const r=t.getRangeAt(0);if(!r)return;const s=r.toString();if(s){if(e==="#000000"){let a=r.commonAncestorContainer;a.nodeType===Node.TEXT_NODE&&(a=a.parentNode);let l=null,n=a;for(;n&&n!==i.current;){if(n.nodeType===Node.ELEMENT_NODE){const c=n;if(c.tagName==="SPAN"&&c.style.color){l=c;break}}n=n.parentNode}if(l){const c=l.parentNode;c&&(c.insertBefore(document.createTextNode(l.textContent||""),l),c.removeChild(l))}}else{const a=document.createElement("span");a.style.color=e,a.textContent=s,r.deleteContents(),r.insertNode(a),r.setStartAfter(a),r.setEndAfter(a),t.removeAllRanges(),t.addRange(r)}u.current=i.current.innerHTML,y(u.current.length)}}}},Q=e=>{if(!i.current)return;const t=window.getSelection();if(!(t&&t.rangeCount>0))return;const r=t.getRangeAt(0);if(!r)return;const s=r.toString();if(!s)return;const a=e==="transparent"?"transparent":e,l=document.createElement("span");l.style.backgroundColor=a,l.textContent=s,r.deleteContents(),r.insertNode(l),r.setStartAfter(l),r.setEndAfter(l),t.removeAllRanges(),t.addRange(r),u.current=i.current.innerHTML,y(u.current.length)},Z=()=>{if(i.current){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(!t)return;const r=t.toString();if(r){let s=t.commonAncestorContainer;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);let a=null,l=s;for(;l&&l!==i.current;){if(l.nodeType===Node.ELEMENT_NODE){const n=l;if(n.tagName==="STRONG"){a=n;break}}l=l.parentNode}if(a){const n=a.parentNode;n&&(n.insertBefore(document.createTextNode(a.textContent||""),a),n.removeChild(a))}else{const n=document.createElement("strong");n.textContent=r,t.deleteContents(),t.insertNode(n)}m(i.current.innerHTML)}}}},ee=()=>{if(i.current){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(!t)return;const r=t.toString();if(r){let s=t.commonAncestorContainer;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);let a=null,l=s;for(;l&&l!==i.current;){if(l.nodeType===Node.ELEMENT_NODE){const n=l;if(n.tagName==="EM"){a=n;break}}l=l.parentNode}if(a){const n=a.parentNode;n&&(n.insertBefore(document.createTextNode(a.textContent||""),a),n.removeChild(a))}else{const n=document.createElement("em");n.textContent=r,t.deleteContents(),t.insertNode(n)}m(i.current.innerHTML)}}}},te=()=>{if(i.current){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(!t)return;const r=t.toString();if(r){let s=t.commonAncestorContainer;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);let a=null,l=s;for(;l&&l!==i.current;){if(l.nodeType===Node.ELEMENT_NODE){const n=l;if(n.tagName==="U"){a=n;break}}l=l.parentNode}if(a){const n=a.parentNode;n&&(n.insertBefore(document.createTextNode(a.textContent||""),a),n.removeChild(a))}else{const n=document.createElement("u");n.textContent=r,t.deleteContents(),t.insertNode(n)}m(i.current.innerHTML)}}}},re=e=>{if(i.current){const t=window.getSelection();if(t&&t.rangeCount>0){const r=t.getRangeAt(0);r.deleteContents(),r.insertNode(document.createTextNode(e)),r.collapse(!1),m(i.current.innerHTML)}}},ne=async()=>{j(!0);try{const e=i.current?.innerHTML??u.current??g;e!==g&&m(e),await H(h,e),S(!1)}catch{alert("ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{j(!1)}},oe=()=>{S(!0),setTimeout(()=>{if(i.current){i.current.focus();const e=document.createRange(),t=window.getSelection();e.selectNodeContents(i.current),e.collapse(!1),t?.removeAllRanges(),t?.addRange(e)}},100)},ae=()=>{m(b),S(!1)},se=async()=>{if(window.confirm("ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){j(!0);try{await H(h,""),D()}catch{alert("ë©”ëª¨ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{j(!1)}}};if(d.useEffect(()=>{const e=t=>{(v||w||k)&&!t.target.closest(".color-palette-container")&&!t.target.closest(".symbol-palette-container")&&(L(!1),M(!1),F(!1))};return(v||w||k)&&document.addEventListener("mousedown",e),()=>{(v||w||k)&&document.removeEventListener("mousedown",e)}},[v,w,k]),!A)return null;const le=e=>{const t=e.target;t.closest('[contenteditable="true"]')||t.closest(".custom-scrollbar")||t.closest('[style*="overflow"]')||t.closest(".memo-content-area")||e.preventDefault()};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center items-center z-[110] p-4 pt-safe",onClick:D,onTouchMove:le,children:o.jsxs("div",{ref:O,className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-6xl p-6 relative animate-fade-in-up flex flex-col my-4 custom-scrollbar",onClick:e=>e.stopPropagation(),style:{maxHeight:"90vh",height:"auto",minHeight:"auto"},children:[o.jsx("button",{onClick:D,className:"absolute top-4 right-4 text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-gray-100 transition-colors",children:o.jsx(ce,{className:"w-6 h-6"})}),o.jsx("div",{className:"flex-shrink-0 mb-2",children:o.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:[o.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:h})," ë„ì‹œ ë©”ëª¨"]})}),o.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[p&&o.jsxs("div",{className:"flex-shrink-0 border border-gray-300 dark:border-gray-600 rounded-t-lg bg-gray-50 dark:bg-gray-700 p-2 flex flex-wrap gap-1",children:[o.jsxs("select",{onChange:e=>V(e.target.value),defaultValue:"14",className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",title:"í°íŠ¸ í¬ê¸°",children:[o.jsx("option",{value:"8",children:"8pt"}),o.jsx("option",{value:"9",children:"9pt"}),o.jsx("option",{value:"10",children:"10pt"}),o.jsx("option",{value:"11",children:"11pt"}),o.jsx("option",{value:"12",children:"12pt"}),o.jsx("option",{value:"14",children:"14pt"}),o.jsx("option",{value:"16",children:"16pt"}),o.jsx("option",{value:"18",children:"18pt"}),o.jsx("option",{value:"20",children:"20pt"}),o.jsx("option",{value:"24",children:"24pt"})]}),o.jsxs("div",{className:"relative color-palette-container",children:[o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>L(!v),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600",title:"í…ìŠ¤íŠ¸ ìƒ‰ìƒ",children:"A"}),v&&o.jsx("div",{className:"absolute top-full left-0 mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-xl",style:{zIndex:9999,width:"140px"},children:o.jsx("div",{className:"grid grid-cols-5 gap-2 justify-items-center",children:["#000000","#FFFFFF","#FF0000","#00AA00","#0066FF","#FF6600","#9900FF","#00AAAA","#FFAA00","#AA00AA"].map(e=>o.jsx("button",{onMouseDown:t=>t.preventDefault(),onClick:()=>{J(e),L(!1)},className:"w-6 h-6 border border-gray-300 dark:border-gray-600 rounded cursor-pointer hover:scale-110 active:scale-95 transition-transform",style:{backgroundColor:e},title:`í…ìŠ¤íŠ¸ ìƒ‰ìƒ: ${e}`},e))})})]}),o.jsxs("div",{className:"relative color-palette-container",children:[o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>M(!w),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600",title:"ë°°ê²½ ìƒ‰ìƒ",children:"ğŸ¨"}),w&&o.jsx("div",{className:"absolute top-full left-0 mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-xl",style:{zIndex:9999,width:"140px"},children:o.jsx("div",{className:"grid grid-cols-5 gap-2 justify-items-center",children:["transparent","#FFE6E6","#E6F3FF","#E6FFE6","#FFF0E6","#F0E6FF","#E6FFFF","#FFFFE6","#FFE6F0","#E6E6E6"].map(e=>o.jsx("button",{onMouseDown:t=>t.preventDefault(),onClick:()=>{Q(e),M(!1)},className:"w-6 h-6 border border-gray-300 dark:border-gray-600 rounded cursor-pointer hover:scale-110 active:scale-95 transition-transform",style:{backgroundColor:e},title:e==="transparent"?"ë°°ê²½ ì—†ìŒ":`ë°°ê²½ ìƒ‰ìƒ: ${e}`},e))})})]}),o.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:Z,className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 font-bold",title:"êµµê²Œ",children:"B"}),o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:ee,className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 italic",title:"ê¸°ìš¸ì„",children:"I"}),o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:te,className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 underline",title:"ë°‘ì¤„",children:"U"}),o.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),o.jsxs("div",{className:"relative symbol-palette-container",children:[o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>F(!k),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600",title:"íŠ¹ìˆ˜ë¬¸ì",children:"Î©"}),k&&o.jsx("div",{className:"absolute top-full left-0 mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-xl",style:{zIndex:9999,width:"140px"},children:o.jsx("div",{className:"grid grid-cols-5 gap-2 justify-items-center",children:["â†","â†’","â†‘","â†“","â†µ","â—","â– ","â–²","â–¼","â—†"].map(e=>o.jsx("button",{onMouseDown:t=>t.preventDefault(),onClick:()=>{re(e),F(!1)},className:"w-6 h-6 border border-gray-300 dark:border-gray-600 rounded cursor-pointer hover:scale-110 active:scale-95 transition-transform text-gray-900 dark:text-gray-100 font-bold",style:{fontSize:"13px"},title:`íŠ¹ìˆ˜ë¬¸ì: ${e}`,children:e},e))})})]}),o.jsx("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>q(!1),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600",title:"ëª©ë¡",children:"â€¢"})]}),o.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[p?o.jsx("div",{ref:i,contentEditable:!0,suppressContentEditableWarning:!0,onInput:I,onKeyDown:K,onPaste:Y,onTouchStart:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),onCompositionStart:X,onCompositionEnd:$,"data-placeholder":`${h} ë„ì‹œì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”...`,className:"memo-content-area w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg resize-none transition-colors custom-scrollbar flex-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 rounded-t-none",style:{minHeight:"200px",maxHeight:"calc(90vh - 180px)",height:"auto",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",whiteSpace:"pre-wrap",wordBreak:"break-word",cursor:"text",userSelect:"text"}}):o.jsx("div",{className:"memo-content-area w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg custom-scrollbar flex-1 bg-white dark:bg-gray-800 text-black dark:text-white",style:{minHeight:"200px",maxHeight:"calc(90vh - 180px)",height:"auto",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",whiteSpace:"pre-wrap",wordBreak:"break-word",cursor:"default",userSelect:"text",textIndent:"0",paddingLeft:"0"},css:`
                                    /* ëª©ë¡ í•­ëª©ì˜ ìë™ ì¤„ë°”ê¿ˆ ë“¤ì—¬ì“°ê¸° */
                                    .memo-content-area {
                                        text-indent: 0;
                                        padding-left: 0;
                                        line-height: 1.5;
                                    }
                                    
                                    /* ëª©ë¡ í•­ëª©ì´ ìë™ìœ¼ë¡œ ì¤„ë°”ê¿ˆë  ë•Œ ë“¤ì—¬ì“°ê¸° */
                                    .memo-content-area {
                                        /* â€¢ ê¸°í˜¸ ë‹¤ìŒ ìœ„ì¹˜ê¹Œì§€ ë“¤ì—¬ì“°ê¸° */
                                        text-indent: -2em;
                                        padding-left: 2em;
                                        hanging-punctuation: first;
                                    }
                                    
                                    /* ì²« ë²ˆì§¸ ì¤„ì€ ë“¤ì—¬ì“°ê¸° í•˜ì§€ ì•ŠìŒ */
                                    .memo-content-area::first-line {
                                        text-indent: 0;
                                    }
                                    
                                    /* ëª©ë¡ í•­ëª©ì—ë§Œ ì ìš© */
                                    .memo-content-area:has(> *:first-child:is([data-bullet])) {
                                        text-indent: -2em;
                                        padding-left: 2em;
                                    }
                                `,dangerouslySetInnerHTML:{__html:g&&g.length>0?g:`<div class="text-gray-400 dark:text-gray-500 italic">${h} ë„ì‹œì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”...</div>`}}),o.jsxs("div",{className:"flex-shrink-0 text-right text-xs text-gray-400 dark:text-gray-500 mt-1",children:[p?_:g.length,"/",z.toLocaleString()]})]})]}),o.jsx("div",{className:"flex-shrink-0 flex justify-between mt-1 pt-1 border-t border-gray-200 dark:border-gray-600",children:p?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:se,className:"px-3 py-1.5 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:C||!g.trim(),children:"ì‚­ì œ"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:ae,className:"px-3 py-1.5 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",disabled:C,children:"ì·¨ì†Œ"}),o.jsx("button",{onClick:ne,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:C,children:C?"ì €ì¥ ì¤‘...":"ì €ì¥"})]})]}):o.jsx("div",{className:"flex justify-center w-full",children:o.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),oe()},className:"px-4 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",type:"button",children:"í¸ì§‘"})})})]})})};export{me as default};
//# sourceMappingURL=CityMemoModal.Cv19KEFJ.js.map
